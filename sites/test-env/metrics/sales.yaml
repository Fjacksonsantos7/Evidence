source:
  datasource: needful_things
  table: orders
  # -- or
  # query: |
  #   SELECT * FROM orders   

metrics:
  - name: avg_sales
    title: Average Sales
    description: |
      This is the average sale $ amount
    expression: sales
    aggregation: avg
    distinct:
      - category # becomes avg(sales) over distinct category
    dimensions:
      - state
      - channel
    default_grain: day
    time_grains:
      - day
      - week
      - month
      - quarter
      - year
    time_expression: order_datetime

  - name: avg_costs
    title: Average Costs
    description: |
      This is the average costs $ amount
    expression: sales
    aggregation: avg
    distinct:
      - category # becomes avg(sales) over distinct category
    dimensions:
      - state
      - channel
    default_grain: day
    time_grains:
      - day
      - week
      - month
      - quarter
      - year
    time_expression: order_datetime

  - # Metadata
    name: avg_profit
    title: Average Profit
    description: |
      This is the average profits per sale
    # Actual Definition
    expression: metric(sales) / metric(cost)
    aggregation: avg
    fmt: pct
    distinct:
      - category # becomes avg(sales) over distinct category
    # Dimensions
    dimensions:
      - state
      - channel
    # Time
    time_expression: order_datetime
    default_grain: day
    time_grains:
      - day
      - week
      - month
      - quarter
      - year
